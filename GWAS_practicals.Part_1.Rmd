---
title: "Practicals GWAS. Exploring phenotype data."
author: "Sodbo Sharapov"
date: "January 22, 2019"
output:
  html_document: 
    keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Outline of the practicals

The practical session consists of XXX steps:

 1. Exploring phenotype data
 2. Exploring genotype data
 3. Quality control of genotype data
 4. Association analysis and GWAS
 5. Vizualization of the results

## Loading phenotype data

Load GenABEL package
 
```{r}
library(GenABEL)
```

Load phenotype and genotype data

```{r}

data("ge03d2")


```

Let's get the Structure of ge03d2 object

```{r}
str(ge03d2)
```

Let's save phenotype data into separate object named *pheno*.
And look at the first rows of the *pheno* object

```{r}

pheno <- phdata(ge03d2)

head(pheno)
```

## Summary of phenotype data

Description of the columns:

  1. ID: id code of sample 
  2. sex: sex, '0' is female, '1' is male
  3. age: age, in years
  4. dm2: diabetes mellitus type 2, '0' is unaffected, '1' is affected
  5. height: height, in cm
  6. wieght: wieght, in kg
  7. diet: following the diet, '0' is false, '1' is true
  8. bmi: BMI, body mass index, in $cm/kg^2$

Now let's have a look at the summary of the phenotype data

```{r}
summary(pheno)
```

For the categorial traits **table** function can be applied to get summary of the trait.

```{r}
table(pheno$sex)
table(pheno$dm2)
table(pheno$diet)
```

## Distribution of traits

You can plot a historgram for quantitaive traits

```{r}
hist(pheno$age, main='Histogram of age', xlab = 'Age')
hist(pheno$height, main='Histogram of height', xlab = 'Height')
hist(pheno$weight, main='Histogram of weight', xlab = 'Weight')
hist(pheno$bmi, main='Histogram of bmi', xlab = 'BMI')
```

## Test for normality

You can test whether the trait's discribution is normal or not using Shapiro test.

```{r}
shapiro.test(pheno$height)
shapiro.test(pheno$weight)
shapiro.test(pheno$bmi)
```

Distribution of BMI has left skewness. Log transformation can transform it to moreless normal

```{r}
hist(log(pheno$bmi), main='Histogram of logBMI', xlab = 'logBMI')
shapiro.test(log(pheno$bmi))
```



## Correlation structure

It is important to check whether your trait of interest is correlated with covariates.
To eheck this you can estimate the Peasron correlation coefficient and/or perform linear regression analysis.
First, let's examine the correlation structure for phenotype data
```{r}
cor_matrix <- cor(pheno[,c('dm2','sex','age','height','weight','bmi','diet')], use='complete.obs')

cor_matrix
```
Now let's vizualize correlation matrix using *corplot* package

```{r}
library(corrplot)

corrplot(cor_matrix)
```

Heatmap clearly shows that dm2 is correlated with weight and bmi.

## Logistic regression of outcome onto covariates

Let's run logistic regression for dm2 vs weight

```{r}
dm2_weight <- glm(dm2~weight,data = pheno,family = 'binomial')
summary(dm2_weight)
```


```{r}
dm2_bmi <- glm(dm2~bmi,data = pheno,family = 'binomial')
summary(dm2_bmi)
```

```{r}
dm2_sex <- glm(dm2~sex,data = pheno,family = 'binomial')
summary(dm2_sex)
```

betaOR for sex is 0.4465, that corresponds to `OR=exp(0.4465)=1.563`, which is concordant with that, calculated from 2x2 table:
```{r}
table(pheno$dm2,pheno$sex)
275*253/210/212
```